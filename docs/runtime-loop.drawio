<mxfile host="app.diagrams.net" modified="2026-02-28T00:00:00.000Z" agent="Claude" version="24.0.0" type="device">
  <diagram id="runtime-loop" name="Runtime Loop">
    <mxGraphModel dx="1100" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="&lt;b&gt;Per-Frame Runtime Loop&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="370" y="20" width="220" height="30" as="geometry" />
        </mxCell>

        <!-- rAF -->
        <mxCell id="raf" value="&lt;b&gt;requestAnimationFrame(time)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=middle;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="350" y="60" width="220" height="35" as="geometry" />
        </mxCell>

        <!-- Arrow -->
        <mxCell id="e0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#666;" edge="1" parent="1" source="raf" target="resize">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Resize -->
        <mxCell id="resize" value="&lt;b&gt;renderer.resize()&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#888&quot; style=&quot;font-size:10px&quot;&gt;sync canvas to display size&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=middle;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="365" y="115" width="190" height="40" as="geometry" />
        </mxCell>

        <!-- Arrow -->
        <mxCell id="e1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6b656;" edge="1" parent="1" source="resize" target="update">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- UPDATE PHASE (yellow group) -->
        <mxCell id="update_group" value="&lt;font color=&quot;#8a7030&quot; style=&quot;font-size:10px&quot;&gt;UPDATE PHASE&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#d6b656;dashed=1;dashPattern=6 3;verticalAlign=top;spacingTop=2;align=left;spacingLeft=8;" vertex="1" parent="1">
          <mxGeometry x="200" y="175" width="550" height="110" as="geometry" />
        </mxCell>

        <!-- scene.update -->
        <mxCell id="update" value="&lt;b&gt;scene.update(time)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=middle;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="370" y="200" width="180" height="35" as="geometry" />
        </mxCell>

        <!-- entity.onUpdate -->
        <mxCell id="entity_update" value="entity.onUpdate(time)&lt;br&gt;&lt;font color=&quot;#888&quot; style=&quot;font-size:9px&quot;&gt;→ mutates Transform&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=middle;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="220" y="245" width="160" height="30" as="geometry" />
        </mxCell>

        <!-- light.onUpdate -->
        <mxCell id="light_update" value="light.onUpdate(time)&lt;br&gt;&lt;font color=&quot;#888&quot; style=&quot;font-size:9px&quot;&gt;→ mutates Light.position&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=middle;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="560" y="245" width="170" height="30" as="geometry" />
        </mxCell>

        <!-- Arrows from update -->
        <mxCell id="e2a" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6b656;" edge="1" parent="1" source="update" target="entity_update">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2b" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#d6b656;" edge="1" parent="1" source="update" target="light_update">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrow update → build -->
        <mxCell id="e3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#6c8ebf;" edge="1" parent="1" source="update" target="build">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="460" y="310" />
              <mxPoint x="460" y="340" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- BUILD PHASE (blue group) -->
        <mxCell id="build_group" value="&lt;font color=&quot;#4a6d8c&quot; style=&quot;font-size:10px&quot;&gt;BUILD PHASE&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#6c8ebf;dashed=1;dashPattern=6 3;verticalAlign=top;spacingTop=2;align=left;spacingLeft=8;" vertex="1" parent="1">
          <mxGeometry x="200" y="310" width="550" height="180" as="geometry" />
        </mxCell>

        <!-- scene.buildFrame -->
        <mxCell id="build" value="&lt;b&gt;scene.buildFrame(aspect)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=middle;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="350" y="340" width="220" height="35" as="geometry" />
        </mxCell>

        <!-- camera.viewProjection -->
        <mxCell id="cam_vp" value="camera.viewProjection()&lt;br&gt;&lt;font color=&quot;#888&quot; style=&quot;font-size:9px&quot;&gt;→ viewProj mat4&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=middle;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="220" y="390" width="160" height="30" as="geometry" />
        </mxCell>

        <!-- light.viewProjection -->
        <mxCell id="light_vp" value="light.viewProjection()&lt;br&gt;&lt;font color=&quot;#888&quot; style=&quot;font-size:9px&quot;&gt;→ lightViewProj mat4&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=middle;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="400" y="390" width="160" height="30" as="geometry" />
        </mxCell>

        <!-- entity.drawCall -->
        <mxCell id="drawcall" value="entity.drawCall()&lt;br&gt;&lt;font color=&quot;#888&quot; style=&quot;font-size:9px&quot;&gt;→ DrawCall[]&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=middle;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="580" y="390" width="150" height="30" as="geometry" />
        </mxCell>

        <!-- Arrows from build -->
        <mxCell id="e4a" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#6c8ebf;" edge="1" parent="1" source="build" target="cam_vp">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e4b" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#6c8ebf;" edge="1" parent="1" source="build" target="light_vp">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e4c" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#6c8ebf;" edge="1" parent="1" source="build" target="drawcall">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Build output label -->
        <mxCell id="build_out" value="{ drawCalls, uniforms }" style="text;html=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontSize=9;fontColor=#888888;" vertex="1" parent="1">
          <mxGeometry x="480" y="445" width="140" height="14" as="geometry" />
        </mxCell>

        <!-- Arrow build → render -->
        <mxCell id="e5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#82b366;" edge="1" parent="1" source="build" target="render">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="460" y="460" />
              <mxPoint x="460" y="520" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- RENDER PHASE -->
        <mxCell id="render" value="&lt;b&gt;renderer.renderFrame(drawCalls, uniforms, options)&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#888&quot; style=&quot;font-size:10px&quot;&gt;6-pass deferred pipeline&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=middle;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="280" y="515" width="360" height="45" as="geometry" />
        </mxCell>

        <!-- Arrow → Screen -->
        <mxCell id="e6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;strokeColor=#82b366;" edge="1" parent="1" source="render" target="screen">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Screen -->
        <mxCell id="screen" value="&lt;b&gt;Screen&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="425" y="580" width="70" height="20" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="leg1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="250" y="630" width="16" height="12" as="geometry" />
        </mxCell>
        <mxCell id="leg1t" value="Update phase" style="text;html=1;align=left;verticalAlign=middle;fillColor=none;strokeColor=none;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="272" y="626" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="370" y="630" width="16" height="12" as="geometry" />
        </mxCell>
        <mxCell id="leg2t" value="Build phase" style="text;html=1;align=left;verticalAlign=middle;fillColor=none;strokeColor=none;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="392" y="626" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg3" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="490" y="630" width="16" height="12" as="geometry" />
        </mxCell>
        <mxCell id="leg3t" value="Render phase" style="text;html=1;align=left;verticalAlign=middle;fillColor=none;strokeColor=none;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="512" y="626" width="80" height="20" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
