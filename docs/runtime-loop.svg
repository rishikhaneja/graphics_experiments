<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 560" font-family="Segoe UI, Arial, sans-serif">
  <!-- Arrow markers -->
  <defs>
    <marker id="a-grey" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#666" stroke-width="1"/>
    </marker>
    <marker id="a-yellow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#d6b656" stroke-width="1"/>
    </marker>
    <marker id="a-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#6c8ebf" stroke-width="1"/>
    </marker>
    <marker id="a-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="none" stroke="#82b366" stroke-width="1"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="350" y="24" text-anchor="middle" font-size="16" font-weight="bold" fill="#333">Per-Frame Runtime Loop</text>

  <!-- rAF -->
  <rect x="220" y="38" width="260" height="30" rx="6" fill="#f5f5f5" stroke="#666" stroke-width="1.2"/>
  <text x="350" y="58" text-anchor="middle" font-size="11" font-weight="bold" fill="#333">requestAnimationFrame(time)</text>
  <line x1="350" y1="68" x2="350" y2="82" stroke="#666" stroke-width="1" marker-end="url(#a-grey)"/>

  <!-- resize -->
  <rect x="250" y="82" width="200" height="28" rx="5" fill="#f5f5f5" stroke="#666" stroke-width="1"/>
  <text x="350" y="100" text-anchor="middle" font-size="10" font-weight="bold" fill="#333">renderer.resize()</text>
  <line x1="350" y1="110" x2="350" y2="128" stroke="#d6b656" stroke-width="1" marker-end="url(#a-yellow)"/>

  <!-- UPDATE PHASE -->
  <rect x="60" y="128" width="580" height="100" rx="8" fill="none" stroke="#d6b656" stroke-width="1" stroke-dasharray="6,3"/>
  <text x="76" y="142" font-size="9" font-weight="bold" fill="#8a7030">UPDATE PHASE</text>

  <!-- scene.update -->
  <rect x="255" y="150" width="190" height="28" rx="5" fill="#fff2cc" stroke="#d6b656" stroke-width="1"/>
  <text x="350" y="168" text-anchor="middle" font-size="10" font-weight="bold" fill="#8a7030">scene.update(time)</text>

  <!-- entity.onUpdate -->
  <line x1="300" y1="178" x2="180" y2="198" stroke="#d6b656" stroke-width="1" marker-end="url(#a-yellow)"/>
  <rect x="80" y="198" width="200" height="22" rx="4" fill="#fff2cc" stroke="#d6b656" stroke-width="0.8"/>
  <text x="180" y="213" text-anchor="middle" font-size="9" fill="#555">entity.onUpdate(time) → Transform</text>

  <!-- light.onUpdate -->
  <line x1="400" y1="178" x2="520" y2="198" stroke="#d6b656" stroke-width="1" marker-end="url(#a-yellow)"/>
  <rect x="420" y="198" width="210" height="22" rx="4" fill="#fff2cc" stroke="#d6b656" stroke-width="0.8"/>
  <text x="525" y="213" text-anchor="middle" font-size="9" fill="#555">light.onUpdate(time) → Light.position</text>

  <!-- Arrow update → build -->
  <line x1="350" y1="228" x2="350" y2="248" stroke="#6c8ebf" stroke-width="1" marker-end="url(#a-blue)"/>

  <!-- BUILD PHASE -->
  <rect x="60" y="248" width="580" height="120" rx="8" fill="none" stroke="#6c8ebf" stroke-width="1" stroke-dasharray="6,3"/>
  <text x="76" y="262" font-size="9" font-weight="bold" fill="#4a6d8c">BUILD PHASE</text>

  <!-- scene.buildFrame -->
  <rect x="240" y="270" width="220" height="28" rx="5" fill="#dae8fc" stroke="#6c8ebf" stroke-width="1"/>
  <text x="350" y="288" text-anchor="middle" font-size="10" font-weight="bold" fill="#4a6d8c">scene.buildFrame(aspect)</text>

  <!-- camera.viewProjection -->
  <line x1="290" y1="298" x2="160" y2="318" stroke="#6c8ebf" stroke-width="1" marker-end="url(#a-blue)"/>
  <rect x="70" y="318" width="180" height="22" rx="4" fill="#dae8fc" stroke="#6c8ebf" stroke-width="0.8"/>
  <text x="160" y="333" text-anchor="middle" font-size="9" fill="#555">camera.viewProjection() → viewProj</text>

  <!-- light.viewProjection -->
  <line x1="350" y1="298" x2="350" y2="318" stroke="#6c8ebf" stroke-width="1" marker-end="url(#a-blue)"/>
  <rect x="262" y="318" width="176" height="22" rx="4" fill="#dae8fc" stroke="#6c8ebf" stroke-width="0.8"/>
  <text x="350" y="333" text-anchor="middle" font-size="9" fill="#555">light.viewProjection() → lightVP</text>

  <!-- entity.drawCall -->
  <line x1="410" y1="298" x2="540" y2="318" stroke="#6c8ebf" stroke-width="1" marker-end="url(#a-blue)"/>
  <rect x="450" y="318" width="180" height="22" rx="4" fill="#dae8fc" stroke="#6c8ebf" stroke-width="0.8"/>
  <text x="540" y="333" text-anchor="middle" font-size="9" fill="#555">entity.drawCall() → DrawCall[]</text>

  <!-- output label -->
  <text x="350" y="358" text-anchor="middle" font-size="9" fill="#888">{ drawCalls, uniforms }</text>

  <!-- Arrow build → render -->
  <line x1="350" y1="368" x2="350" y2="388" stroke="#82b366" stroke-width="1.2" marker-end="url(#a-green)"/>

  <!-- RENDER -->
  <rect x="140" y="388" width="420" height="40" rx="6" fill="#d5e8d4" stroke="#82b366" stroke-width="1.2"/>
  <text x="350" y="407" text-anchor="middle" font-size="11" font-weight="bold" fill="#4a7a44">renderer.renderFrame(drawCalls, uniforms, options)</text>
  <text x="350" y="422" text-anchor="middle" font-size="9" fill="#888">6-pass deferred pipeline</text>

  <!-- Arrow → Screen -->
  <line x1="350" y1="428" x2="350" y2="448" stroke="#82b366" stroke-width="1.2" marker-end="url(#a-green)"/>
  <text x="350" y="464" text-anchor="middle" font-size="12" font-weight="bold" fill="#333">Screen</text>

  <!-- Legend -->
  <rect x="170" y="500" width="12" height="10" rx="2" fill="#fff2cc" stroke="#d6b656" stroke-width="0.8"/>
  <text x="188" y="509" font-size="9" fill="#666">Update phase</text>

  <rect x="290" y="500" width="12" height="10" rx="2" fill="#dae8fc" stroke="#6c8ebf" stroke-width="0.8"/>
  <text x="308" y="509" font-size="9" fill="#666">Build phase</text>

  <rect x="400" y="500" width="12" height="10" rx="2" fill="#d5e8d4" stroke="#82b366" stroke-width="0.8"/>
  <text x="418" y="509" font-size="9" fill="#666">Render phase</text>
</svg>
